<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>StadiumPRO - המפה שלך למגרש</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1e293b">
    
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/821/821321.png">
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/821/821321.png">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        :root { --primary: #2563eb; --dark: #1e293b; --bg: #f3f4f6; --waze: #33ccff; }
        body { margin: 0; display: flex; font-family: system-ui, -apple-system, sans-serif; height: 100vh; background: var(--bg); overflow: hidden; }
        
        #sidebar { width: 380px; background: white; border-left: 1px solid #ddd; display: flex; flex-direction: column; z-index: 1001; box-shadow: 4px 0 15px rgba(0,0,0,0.1); }
        .sidebar-header { background: var(--dark); color: white; padding: 25px 20px; text-align: center; position: relative; }
        .sidebar-header h2 { margin: 0; font-size: 1.5rem; letter-spacing: 1px; }
        
        .contact-trigger { position: absolute; left: 15px; top: 25px; color: #94a3b8; cursor: pointer; font-size: 1.2rem; transition: 0.3s; }
        .contact-trigger:hover { color: white; }

        .search-box { padding: 15px; border-bottom: 1px solid #eee; background: white; }
        #search { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 12px; box-sizing: border-box; }
        
        #list { overflow-y: auto; flex: 1; padding: 15px; background: #f8fafc; }
        .card { background: white; border: 1px solid #e5e7eb; border-radius: 16px; margin-bottom: 15px; cursor: pointer; overflow: hidden; transition: 0.3s; }
        .card:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .card-sat { height: 90px; background-size: cover; background-position: center; }
        .card-info { padding: 12px; }
        
        #map { flex: 1; }
        
        .popup-card { width: 300px; direction: rtl; }
        .popup-header { background: var(--dark); color: white; padding: 10px; border-radius: 10px 10px 0 0; text-align: center; margin: -14px -14px 10px -14px; font-weight: bold; }
        
        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .btn { background: #f1f5f9; border: 1px solid #e2e8f0; padding: 10px; border-radius: 10px; text-align: center; cursor: pointer; font-size: 0.8rem; text-decoration: none; color: #334155; font-weight: bold; display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .btn i { color: var(--primary); font-size: 1rem; }
        .btn-waze-main { background: var(--waze); color: white !important; grid-column: span 2; flex-direction: row; justify-content: center; gap: 8px; border: none; font-size: 0.95rem; }
        
        .seats-box { background: #0f172a; padding: 10px; border-radius: 10px; margin-top: 10px; display: none; }
        .stadium-svg { width: 100%; height: auto; display: block; }
        
        .overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 2000; justify-content: center; align-items: center; backdrop-filter: blur(4px); }
        .modal { background: white; padding: 25px; border-radius: 20px; width: 300px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        
        .email-display { background: #f1f5f9; padding: 12px; border-radius: 8px; font-family: monospace; font-size: 0.9rem; margin: 15px 0; border: 1px dashed #cbd5e1; user-select: all; }
        .copy-btn { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; }

        @media (max-width: 768px) {
            body { flex-direction: column-reverse; }
            #sidebar { width: 100%; height: 40vh; border-left: none; }
            #map { height: 60vh; }
        }
    </style>
</head>
<body>

<div id="sidebar">
    <div class="sidebar-header">
        <i class="fa-solid fa-envelope contact-trigger" onclick="openContact()"></i>
        <h2>StadiumPRO</h2>
    </div>
    <div class="search-box"><input type="text" id="search" placeholder="חפש אצטדיון..." oninput="renderList()"></div>
    <div id="list"></div>
</div>
<div id="map"></div>

<div id="overlay" class="overlay" onclick="this.style.display='none'">
    <div class="modal" onclick="event.stopPropagation()">
        <h3 id="choice-title" style="margin-top:0;"></h3>
        <div id="choice-list"></div>
    </div>
</div>

<div id="contact-overlay" class="overlay" onclick="this.style.display='none'">
    <div class="modal" onclick="event.stopPropagation()">
        <h3 style="margin-top:0;">יצירת קשר</h3>
        <p style="font-size:0.85rem; color:#64748b;">להצעות שיפור או דיווח על טעות, שלחו מייל לכתובת:</p>
        <div class="email-display" id="emailAddr">galactico2818@gmail.com</div>
        <button class="copy-btn" onclick="copyEmail()">העתק כתובת מייל</button>
        <p id="copyStatus" style="font-size:0.7rem; color:green; margin-top:8px; display:none;">הכתובת הועתקה!</p>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    var map = L.map('map', { zoomControl: false }).setView([32.1, 34.8], 8);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png').addTo(map);

    var stadiums = [
        { id: 1, name: "סמי עופר", teams: "מכבי חיפה, הפועל חיפה", coords: [32.7833, 34.9667], parking: [{n: "חניון P5", c: [32.7805, 34.9625]}], food: [{n: "בורגר סאלון", c: [32.7825, 34.9655]}, {n: "רפאלו", c: [32.7835, 34.9658]}] },
        { id: 2, name: "טדי", teams: "בית\"ר י-ם, הפועל י-ם", coords: [31.7511, 35.1906], parking: [{n: "קניון מלחה", c: [31.7515, 35.1865]}], food: [{n: "שיפודי ציפורה", c: [31.7512, 35.1872]}] },
        { id: 3, name: "בלומפילד", teams: "מכבי ת\"א, הפועל ת\"א", coords: [32.0517, 34.7615], parking: [{n: "חניון התחנה", c: [32.0592, 34.7617]}], food: [{n: "מפגש בלומפילד", c: [32.0526, 34.7625]}] },
        { id: 4, name: "טרנר", teams: "הפועל ב\"ש", coords: [31.2731, 34.7793], parking: [{n: "הקונכייה", c: [31.2720, 34.7770]}], food: [{n: "Vivino", c: [31.2660, 34.7955]}] },
        { id: 5, name: "נתניה", teams: "מכבי נתניה", coords: [32.2943, 34.8645], parking: [{n: "חניון מזרחי", c: [32.2950, 34.8660]}], food: [{n: "בורגרים", c: [32.2940, 34.8640]}] },
        { id: 6, name: "המושבה", teams: "מכבי/הפועל פ\"ת", coords: [32.1041, 34.8650], parking: [{n: "חניון הרכבת", c: [32.1025, 34.8665]}], food: [{n: "אלפרדו", c: [32.1120, 34.8690]}] },
        { id: 7, name: "דוחא", teams: "בני סכנין", coords: [32.8666, 35.3108], parking: [{n: "חניה סמוכה", c: [32.8650, 35.3110]}], food: [{n: "מדמס", c: [32.8645, 35.3105]}] },
        { id: 8, name: "הי\"א", teams: "מ.ס. אשדוד", coords: [31.8102, 34.6483], parking: [{n: "חניון החוף", c: [31.8120, 34.6450]}], food: [{n: "שניצלהיט", c: [31.8135, 34.6495]}] },
        { id: 9, name: "גרין", teams: "בני ריינה", coords: [32.6899, 35.3113], parking: [{n: "חניון המגרש", c: [32.6910, 35.3100]}], food: [{n: "סילביס", c: [32.6940, 35.3040]}] }
    ];

    const stadiumMaps = {
        "סמי עופר": `<svg viewBox="0 0 200 120" class="stadium-svg"><rect x="40" y="30" width="120" height="60" fill="#065f46"/><rect x="40" y="5" width="120" height="20" stroke="orange" fill="none" stroke-width="2"/><text x="100" y="18" fill="white" font-size="10" text-anchor="middle">צפוני</text><rect x="40" y="95" width="120" height="20" stroke="white" fill="none" stroke-width="2"/><text x="100" y="108" fill="white" font-size="10" text-anchor="middle">דרומי</text></svg>`,
        "טדי": `<svg viewBox="0 0 200 120" class="stadium-svg"><rect x="50" y="30" width="100" height="60" fill="#065f46"/><rect x="50" y="5" width="100" height="20" stroke="orange" fill="none" stroke-width="2"/><text x="100" y="18" fill="white" font-size="10" text-anchor="middle">צפוני</text><rect x="50" y="95" width="100" height="20" stroke="white" fill="none" stroke-width="2"/><text x="100" y="108" fill="white" font-size="10" text-anchor="middle">דרומי</text></svg>`,
        "בלומפילד": `<svg viewBox="0 0 200 120" class="stadium-svg"><rect x="50" y="30" width="100" height="60" fill="#065f46"/><rect x="50" y="5" width="100" height="20" stroke="orange" fill="none" stroke-width="2"/><text x="100" y="18" fill="white" font-size="10" text-anchor="middle">צפוני</text><rect x="50" y="95" width="100" height="20" stroke="white" fill="none" stroke-width="2"/><text x="100" y="108" fill="white" font-size="10" text-anchor="middle">דרומי</text></svg>`
    };

    function renderList() {
        var term = document.getElementById('search').value;
        var list = document.getElementById('list');
        list.innerHTML = "";
        stadiums.forEach(s => {
            if (s.name.includes(term) || s.teams.includes(term)) {
                let div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `<div class="card-sat" style="background-image: url('https://static-maps.yandex.ru/1.x/?ll=${s.coords[1]},${s.coords[0]}&z=16&l=sat');"></div><div class="card-info"><b>${s.name}</b></div>`;
                div.onclick = () => { map.flyTo(s.coords, 16); setTimeout(() => openPopup(s), 300); };
                list.appendChild(div);
            }
        });
    }

    function openPopup(s) {
        let svg = stadiumMaps[s.name] || `<p style='color:white;text-align:center;font-size:0.8rem;'>מפת יציעים בקרוב...</p>`;
        let content = `<div class="popup-card"><div class="popup-header">${s.name}</div><div class="action-grid"><a href="https://waze.com/ul?ll=${s.coords[0]},${s.coords[1]}&navigate=yes" target="_blank" class="btn btn-waze-main"><i class="fa-brands fa-waze"></i> ניווט בוויז</a><div class="btn" onclick="openChoice(${s.id}, 'parking')"><i class="fa-solid fa-parking"></i> חניה</div><div class="btn" onclick="openChoice(${s.id}, 'food')"><i class="fa-solid fa-utensils"></i> אוכל</div><div class="btn" onclick="document.getElementById('seats-${s.id}').style.display='block'" style="grid-column: span 2;"><i class="fa-solid fa-map"></i> הצג מפת יציעים</div></div><div id="seats-${s.id}" class="seats-box">${svg}</div></div>`;
        L.popup().setLatLng(s.coords).setContent(content).openOn(map);
    }

    function openChoice(id, type) {
        let s = stadiums.find(x => x.id === id);
        let list = document.getElementById('choice-list');
        document.getElementById('choice-title').innerText = (type === 'parking' ? 'חניה' : 'אוכל');
        list.innerHTML = "";
        s[type].forEach(opt => {
            let d = document.createElement('div');
            d.style.padding = "12px"; d.style.borderBottom = "1px solid #eee"; d.style.cursor = "pointer"; d.style.fontWeight = "bold";
            d.innerHTML = opt.n;
            d.onclick = () => window.open(`https://waze.com/ul?ll=${opt.c[0]},${opt.c[1]}&navigate=yes`);
            list.appendChild(d);
        });
        document.getElementById('overlay').style.display = 'flex';
    }

    function openContact() { document.getElementById('contact-overlay').style.display = 'flex'; }
    
    function copyEmail() {
        var email = document.getElementById('emailAddr').innerText;
        navigator.clipboard.writeText(email);
        document.getElementById('copyStatus').style.display = 'block';
        setTimeout(() => { document.getElementById('copyStatus').style.display = 'none'; }, 2000);
    }

    stadiums.forEach(s => { L.marker(s.coords).addTo(map).on('click', () => openPopup(s)); });
    renderList();
</script>
</body>
</html>
